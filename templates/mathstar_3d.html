<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathStar 3D - Interactive Math Learning | Sanchari Mentors</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide React Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Custom CSS for 3D effects -->
    <style>
        .rotate-3d {
            transform: rotateY(15deg) rotateX(15deg);
        }
        
        .-rotate-3d {
            transform: rotateY(-15deg) rotateX(-15deg);
        }
        
        .floating-elements {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .glow {
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }
        
        .feature-card {
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
            border-radius: 1rem;
            padding: 2rem;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .feature-icon {
            width: 4rem;
            height: 4rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: white;
            font-size: 1.5rem;
        }
        
        .stat-item {
            text-align: center;
            padding: 2rem;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: block;
        }
        
        .stat-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: #374151;
            margin-top: 0.5rem;
        }
        
        .section-title {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }
        
        .section-subtitle {
            font-size: 1.1rem;
            color: #6b7280;
            line-height: 1.6;
        }
        
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8rem 0 4rem;
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="0.5" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }
        
        .hero-content {
            position: relative;
            z-index: 1;
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .hero-subtitle {
            font-size: 1.5rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }
        
        .hero-description {
            font-size: 1.1rem;
            opacity: 0.8;
            line-height: 1.6;
        }
        
        .floating-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin: 1rem;
            text-align: center;
            animation: float 6s ease-in-out infinite;
        }
        
        .floating-card:nth-child(2) {
            animation-delay: -2s;
        }
        
        .floating-card:nth-child(3) {
            animation-delay: -4s;
        }
        
        .floating-card i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .slide-up {
            animation: slideUp 1s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in {
            animation: fadeIn 1s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .announcement-banner {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 0.75rem 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            overflow: hidden;
        }
        
        .banner-content {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .banner-text {
            white-space: nowrap;
            animation: scroll 30s linear infinite;
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .banner-icon {
            color: #ffeaa7;
        }
        
        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .logo-img {
            height: 48px;
            width: auto;
            object-fit: contain;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" style="margin-top: 60px;">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <img src="/static/images/logo.png" alt="Sanchari Mentors Logo" class="logo-img me-2" />
                <span class="fw-bold">Sanchari Mentors</span>
            </a>
            <div class="ms-auto">
                <a href="/" class="btn btn-outline-primary me-2">
                    <i class="fas fa-home me-2"></i>Home
                </a>
                <div class="text-center mt-4">
                    <a href="{{ url_for('login') }}" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt me-2"></i>Login to Play
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- MathStar 3D Game Container -->
    <div id="mathstar-root" style="margin-top: 120px;">
        <div class="min-h-screen bg-gradient-to-br from-indigo-100 via-purple-50 to-pink-100 p-4">
            <!-- Header -->
            <div class="bg-white shadow-lg border-b-4 border-indigo-400 rounded-lg mb-6">
                <div class="p-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-3 rounded-xl">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h1 class="text-3xl font-bold text-indigo-600">MathStar 3D</h1>
                                <p class="text-gray-600">Interactive Math Learning</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2 bg-yellow-100 px-4 py-2 rounded-full">
                                <svg class="w-5 h-5 text-yellow-500 fill-current" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                </svg>
                                <span class="font-bold text-yellow-700" id="stars-display">150</span>
                            </div>
                            <div class="flex items-center space-x-2 bg-indigo-100 px-4 py-2 rounded-full">
                                <svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                </svg>
                                <span class="font-bold text-indigo-700">Grade <span id="grade-display">4</span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="max-w-4xl mx-auto">
                <div class="grid lg:grid-cols-4 gap-6">
                    <!-- Sidebar -->
                    <div class="lg:col-span-1 space-y-4">
                        <!-- Grade Selection -->
                        <div class="bg-white rounded-xl shadow-lg p-4">
                            <h3 class="font-bold text-gray-800 mb-3 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                                Grade Level
                            </h3>
                            <div class="grid grid-cols-3 gap-2" id="grade-buttons">
                                <!-- Grade buttons will be generated by JavaScript -->
                            </div>
                        </div>

                        <!-- Topic Selection -->
                        <div class="bg-white rounded-xl shadow-lg p-4">
                            <h3 class="font-bold text-gray-800 mb-3 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Math Topics
                            </h3>
                            <div class="space-y-2" id="topic-buttons">
                                <!-- Topic buttons will be generated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Main Game Area -->
                    <div class="lg:col-span-3">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div id="game-content">
                                <!-- Game content will be generated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Game JavaScript -->
    <script>
        // Game state
        let currentGrade = 4;
        let currentTopic = 'addition';
        let currentProblem = null;
        let userAnswer = '';
        let stars = 150;
        let attempts = 0;
        let showResult = false;
        let isCorrect = false;
        let showCorrectAnswer = false;
        let studentName = '';
        let studentClass = '';
        let showNameInput = true;
        let leaderboard = JSON.parse(localStorage.getItem('mathstar_leaderboard') || '[]');
        let currentSessionScore = 0;
        let problemsSolved = 0;

        const topics = {
            // Elementary Grades (4-6)
            addition: { name: 'Addition', icon: '‚ûï', color: 'bg-blue-500', grades: [4, 5, 6] },
            subtraction: { name: 'Subtraction', icon: '‚ûñ', color: 'bg-red-500', grades: [4, 5, 6] },
            multiplication: { name: 'Multiplication', icon: '‚úñÔ∏è', color: 'bg-green-500', grades: [4, 5, 6] },
            division: { name: 'Division', icon: '‚ûó', color: 'bg-purple-500', grades: [4, 5, 6] },
            fractions: { name: 'Fractions', icon: '¬Ω', color: 'bg-orange-500', grades: [5, 6] },
            decimals: { name: 'Decimals', icon: '.', color: 'bg-pink-500', grades: [5, 6] },
            percentages: { name: 'Percentages', icon: '%', color: 'bg-indigo-500', grades: [6] },
            
            // Middle School (7-8)
            algebra: { name: 'Algebra', icon: 'ùë•', color: 'bg-teal-500', grades: [7, 8, 9, 10, 11, 12] },
            geometry: { name: 'Geometry', icon: '‚ñ≥', color: 'bg-cyan-500', grades: [7, 8, 9, 10, 11, 12] },
            wordProblems: { name: 'Word Problems', icon: 'üìù', color: 'bg-yellow-500', grades: [7, 8] },
            ratios: { name: 'Ratios', icon: '‚à∂', color: 'bg-lime-500', grades: [7, 8] },
            integers: { name: 'Integers', icon: '‚Ñ§', color: 'bg-amber-500', grades: [7, 8] },
            
            // High School (9-12)
            linearEquations: { name: 'Linear Equations', icon: 'ùë¶=ùëöùë•+ùëè', color: 'bg-emerald-500', grades: [9, 10, 11, 12] },
            quadraticEquations: { name: 'Quadratic Equations', icon: 'ùë•¬≤', color: 'bg-violet-500', grades: [10, 11, 12] },
            trigonometry: { name: 'Trigonometry', icon: 'sin', color: 'bg-rose-500', grades: [11, 12] },
            calculus: { name: 'Calculus', icon: '‚à´', color: 'bg-slate-500', grades: [12] },
            statistics: { name: 'Statistics', icon: 'œÉ', color: 'bg-fuchsia-500', grades: [11, 12] },
            probability: { name: 'Probability', icon: 'P', color: 'bg-sky-500', grades: [9, 10, 11, 12] }
        };

        function generateProblem(topic, grade) {
            const difficulty = Math.max(1, grade - 3);
            
            switch(topic) {
                // Elementary Topics
                case 'addition':
                    const a = Math.floor(Math.random() * (50 * difficulty)) + 1;
                    const b = Math.floor(Math.random() * (50 * difficulty)) + 1;
                    return { question: `${a} + ${b} = ?`, answer: a + b };
                
                case 'subtraction':
                    const x = Math.floor(Math.random() * (50 * difficulty)) + 20;
                    const y = Math.floor(Math.random() * x) + 1;
                    return { question: `${x} - ${y} = ?`, answer: x - y };
                
                case 'multiplication':
                    const m = Math.floor(Math.random() * (5 * difficulty)) + 2;
                    const n = Math.floor(Math.random() * (5 * difficulty)) + 2;
                    return { question: `${m} √ó ${n} = ?`, answer: m * n };
                
                case 'division':
                    const divisor = Math.floor(Math.random() * (5 * difficulty)) + 2;
                    const quotient = Math.floor(Math.random() * (8 * difficulty)) + 1;
                    const dividend = divisor * quotient;
                    return { question: `${dividend} √∑ ${divisor} = ?`, answer: quotient };
                
                case 'fractions':
                    const num = Math.floor(Math.random() * 8) + 1;
                    const den = Math.floor(Math.random() * 8) + num + 1;
                    return { question: `What is ${num}/${den} as a decimal? (Round to 2 places)`, answer: Math.round((num / den) * 100) / 100 };
                
                case 'decimals':
                    const dec1 = Math.round((Math.random() * 10) * 100) / 100;
                    const dec2 = Math.round((Math.random() * 10) * 100) / 100;
                    return { question: `${dec1} + ${dec2} = ?`, answer: Math.round((dec1 + dec2) * 100) / 100 };
                
                case 'percentages':
                    const base = Math.floor(Math.random() * 100) + 10;
                    const percent = Math.floor(Math.random() * 50) + 10;
                    return { question: `What is ${percent}% of ${base}?`, answer: Math.round((percent / 100) * base) };
                
                // Middle School Topics
                case 'algebra':
                    const coef = Math.floor(Math.random() * 5) + 1;
                    const constant = Math.floor(Math.random() * 10) + 1;
                    const result = Math.floor(Math.random() * 20) + 5;
                    const solution = (result - constant) / coef;
                    return { question: `If ${coef}x + ${constant} = ${result}, what is x?`, answer: solution };
                
                case 'geometry':
                    const side = Math.floor(Math.random() * 10) + 2;
                    return { question: `What is the area of a square with side length ${side}?`, answer: side * side };
                
                case 'wordProblems':
                    const items = Math.floor(Math.random() * 20) + 5;
                    const price = Math.floor(Math.random() * 5) + 1;
                    return { question: `If ${items} items cost $${items * price}, what is the cost per item?`, answer: price };
                
                case 'ratios':
                    const ratio1 = Math.floor(Math.random() * 5) + 1;
                    const ratio2 = Math.floor(Math.random() * 5) + 1;
                    const total = Math.floor(Math.random() * 20) + 10;
                    const part1 = Math.round((ratio1 / (ratio1 + ratio2)) * total);
                    return { question: `In a ratio of ${ratio1}:${ratio2}, if the total is ${total}, what is the first part?`, answer: part1 };
                
                case 'integers':
                    const int1 = Math.floor(Math.random() * 20) - 10;
                    const int2 = Math.floor(Math.random() * 20) - 10;
                    return { question: `${int1} + ${int2} = ?`, answer: int1 + int2 };
                
                // High School Topics
                case 'linearEquations':
                    const slope = Math.floor(Math.random() * 5) + 1;
                    const yInt = Math.floor(Math.random() * 10) - 5;
                    const xVal = Math.floor(Math.random() * 10) - 5;
                    const yVal = slope * xVal + yInt;
                    return { question: `In y = ${slope}x + ${yInt}, if x = ${xVal}, what is y?`, answer: yVal };
                
                case 'quadraticEquations':
                    const a1 = 1;
                    const b1 = Math.floor(Math.random() * 10) - 5;
                    const c1 = Math.floor(Math.random() * 10) - 5;
                    const x1 = Math.floor(Math.random() * 5) - 2;
                    const y1 = a1 * x1 * x1 + b1 * x1 + c1;
                    return { question: `In y = x¬≤ + ${b1}x + ${c1}, if x = ${x1}, what is y?`, answer: y1 };
                
                case 'trigonometry':
                    const angle = Math.floor(Math.random() * 4) * 30; // 0, 30, 60, 90 degrees
                    let trigResult;
                    switch(angle) {
                        case 0: trigResult = 0; break;
                        case 30: trigResult = 0.5; break;
                        case 60: trigResult = 0.866; break;
                        case 90: trigResult = 1; break;
                        default: trigResult = 0;
                    }
                    return { question: `What is sin(${angle}¬∞)? (Round to 3 places)`, answer: Math.round(trigResult * 1000) / 1000 };
                
                case 'calculus':
                    const power = Math.floor(Math.random() * 3) + 2;
                    const coef2 = Math.floor(Math.random() * 5) + 1;
                    const x2 = Math.floor(Math.random() * 5) + 1;
                    const derivative = coef2 * power * Math.pow(x2, power - 1);
                    return { question: `What is the derivative of ${coef2}x^${power} at x = ${x2}?`, answer: derivative };
                
                case 'statistics':
                    const mean = Math.floor(Math.random() * 10) + 5;
                    const deviation = Math.floor(Math.random() * 3) + 1;
                    const zScore = Math.floor(Math.random() * 3) - 1;
                    const value = mean + (zScore * deviation);
                    return { question: `If mean = ${mean} and standard deviation = ${deviation}, what value has a z-score of ${zScore}?`, answer: value };
                
                case 'probability':
                    const favorable = Math.floor(Math.random() * 5) + 1;
                    const total2 = Math.floor(Math.random() * 10) + favorable;
                    const prob = Math.round((favorable / total2) * 100);
                    return { question: `What is the probability of ${favorable} out of ${total2}? (Answer as percentage)`, answer: prob };
                
                default:
                    return generateProblem('addition', grade);
            }
        }

        function updateCheckButton() {
            const checkBtn = document.getElementById('check-answer-btn');
            if (checkBtn) {
                const shouldEnable = userAnswer !== '' && !showNameInput && 
                    (!showResult || (!isCorrect && attempts < 4));
                checkBtn.disabled = !shouldEnable;
            }
        }

        function updateLeaderboard() {
            if (studentName && studentClass) {
                const existingEntry = leaderboard.find(entry => 
                    entry.name === studentName && entry.class === studentClass
                );
                if (existingEntry) {
                    // Always update the entry with the latest score and problems solved
                    existingEntry.totalStars = stars;
                    existingEntry.problemsSolved = problemsSolved;
                    existingEntry.lastPlayed = new Date().toISOString();
                } else {
                    leaderboard.push({
                        name: studentName,
                        class: studentClass,
                        totalStars: stars,
                        problemsSolved: problemsSolved,
                        lastPlayed: new Date().toISOString()
                    });
                }
                // Sort leaderboard by total stars (descending)
                leaderboard.sort((a, b) => b.totalStars - a.totalStars);
                // Keep only top 20 entries
                leaderboard = leaderboard.slice(0, 20);
                localStorage.setItem('mathstar_leaderboard', JSON.stringify(leaderboard));
            }
        }

        function checkAnswer() {
            if (userAnswer === '' || showNameInput) return;
            attempts++;
            const correct = parseFloat(userAnswer) === currentProblem.answer;
            if (correct) {
                let starsEarned;
                if (attempts === 1) {
                    starsEarned = 5;
                } else if (attempts === 2) {
                    starsEarned = 3;
                } else if (attempts === 3) {
                    starsEarned = 1;
                } else {
                    starsEarned = 0;
                }
                stars += starsEarned;
                currentSessionScore += starsEarned;
                problemsSolved++;
                isCorrect = true;
                showResult = true;
            } else {
                if (attempts >= 4) {
                    showCorrectAnswer = true;
                    showResult = true;
                } else {
                    showResult = true;
                }
            }
            // Always update leaderboard and display after every answer
            updateLeaderboard();
            updateCheckButton();
            updateDisplay();
        }

        function nextProblem() {
            userAnswer = '';
            attempts = 0;
            showResult = false;
            isCorrect = false;
            showCorrectAnswer = false;
            
            // Generate new problem using the generateProblem function
            currentProblem = generateProblem(currentTopic, currentGrade);
            
            updateCheckButton();
            updateDisplay();
        }

        function resetProblem() {
            userAnswer = '';
            attempts = 0;
            showResult = false;
            isCorrect = false;
            showCorrectAnswer = false;
            updateCheckButton();
            updateDisplay();
        }

        function setGrade(grade) {
            currentGrade = grade;
            // Reset topic to first available for this grade
            const availableTopics = Object.entries(topics).filter(([key, topic]) => topic.grades.includes(grade));
            if (availableTopics.length > 0) {
                currentTopic = availableTopics[0][0];
            }
            nextProblem();
        }

        function setTopic(topic) {
            currentTopic = topic;
            nextProblem();
        }

        function saveStudentInfo() {
            const nameInput = document.getElementById('student-name-input');
            const classInput = document.getElementById('student-class-input');
            
            if (nameInput && classInput) {
                studentName = nameInput.value.trim();
                studentClass = classInput.value.trim();
                
                if (studentName && studentClass) {
                    showNameInput = false;
                    localStorage.setItem('mathstar_student_name', studentName);
                    localStorage.setItem('mathstar_student_class', studentClass);
                    updateDisplay();
                } else {
                    alert('Please enter both name and class!');
                }
            }
        }

        function resetStudent() {
            studentName = '';
            studentClass = '';
            showNameInput = true;
            stars = 150;
            currentSessionScore = 0;
            problemsSolved = 0;
            localStorage.removeItem('mathstar_student_name');
            localStorage.removeItem('mathstar_student_class');
            updateDisplay();
        }

        function clearLeaderboard() {
            // Function disabled - leaderboard cannot be cleared
            alert('Leaderboard clearing is disabled. All scores are preserved for student motivation.');
        }

        function updateDisplay() {
            // Update stars display
            document.getElementById('stars-display').textContent = stars;
            document.getElementById('grade-display').textContent = currentGrade;

            // Check if student info exists in localStorage
            if (!studentName && !studentClass) {
                const savedName = localStorage.getItem('mathstar_student_name');
                const savedClass = localStorage.getItem('mathstar_student_class');
                if (savedName && savedClass) {
                    studentName = savedName;
                    studentClass = savedClass;
                    showNameInput = false;
                }
            }

            // Update grade buttons
            const gradeButtons = document.getElementById('grade-buttons');
            gradeButtons.innerHTML = '';
            [4, 5, 6, 7, 8, 9, 10, 11, 12].forEach(grade => {
                const button = document.createElement('button');
                button.className = `p-2 rounded-lg font-bold transition-all ${
                    currentGrade === grade
                        ? 'bg-indigo-500 text-white shadow-lg'
                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`;
                button.textContent = grade;
                button.onclick = () => setGrade(grade);
                gradeButtons.appendChild(button);
            });

            // Update topic buttons (only show topics available for current grade)
            const topicButtons = document.getElementById('topic-buttons');
            topicButtons.innerHTML = '';
            Object.entries(topics)
                .filter(([key, topic]) => topic.grades.includes(currentGrade))
                .forEach(([key, topic]) => {
                    const button = document.createElement('button');
                    button.className = `w-full p-3 rounded-lg text-left transition-all flex items-center space-x-3 ${
                        currentTopic === key
                            ? `${topic.color} text-white shadow-lg`
                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                    }`;
                    button.innerHTML = `
                        <span class="text-xl">${topic.icon}</span>
                        <span class="font-medium">${topic.name}</span>
                    `;
                    button.onclick = () => setTopic(key);
                    topicButtons.appendChild(button);
                });

            // Update game content
            const gameContent = document.getElementById('game-content');
            if (currentProblem) {
                gameContent.innerHTML = `
                    <!-- Student Info Section -->
                    ${showNameInput ? `
                        <div class="mb-6">
                            <h3 class="text-xl font-bold mb-4">Welcome to MathStar 3D!</h3>
                            <div class="space-y-3">
                                <input class="w-full border p-2 rounded" placeholder="Your Name" value="${studentName}" oninput="studentName = this.value" />
                                <input class="w-full border p-2 rounded" placeholder="Your Class" value="${studentClass}" oninput="studentClass = this.value" />
                                <button class="w-full bg-indigo-500 text-white px-4 py-2 rounded" onclick="if(studentName && studentClass){showNameInput=false;localStorage.setItem('mathstar_student_name',studentName);localStorage.setItem('mathstar_student_class',studentClass);updateDisplay();}">Start Playing</button>
                            </div>
                            ${leaderboard.length > 0 ? `
                            <div id="existing-students" class="mt-4">
                                <h4 class="text-md font-semibold mb-2">Or select your name:</h4>
                                <div class="flex flex-wrap gap-2">
                                    ${leaderboard.map(entry => `
                                        <button onclick="selectExistingStudent('${entry.name}', '${entry.class}')" class="bg-indigo-100 hover:bg-indigo-200 text-indigo-800 px-3 py-1 rounded">${entry.name} (${entry.class})</button>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}
                        </div>
                    ` : `
                        <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                    <div>
                                        <span class="font-semibold text-blue-800">${studentName}</span>
                                        <span class="text-blue-600"> - ${studentClass}</span>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-blue-600">Problems: ${problemsSolved}</span>
                                    <button
                                        onclick="resetStudent()"
                                        class="text-sm text-red-600 hover:text-red-800 underline"
                                    >
                                        Change Student
                                    </button>
                                </div>
                            </div>
                        </div>
                    `}

                    <!-- Problem Header -->
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">
                            ${topics[currentTopic].name} - Grade ${currentGrade}
                        </h2>
                        <div class="flex items-center justify-between">
                            <p class="text-gray-600">Attempt ${attempts} of 4</p>
                            ${!showResult || (!isCorrect && attempts < 4) ? `
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm text-gray-500">Attempts remaining:</span>
                                    <div class="flex space-x-1">
                                        ${Array.from({length: 4 - attempts}, () => 
                                            '<div class="w-3 h-3 bg-green-400 rounded-full"></div>'
                                        ).join('')}
                                        ${Array.from({length: attempts}, () => 
                                            '<div class="w-3 h-3 bg-gray-300 rounded-full"></div>'
                                        ).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>

                    <!-- Problem -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-8 rounded-xl mb-6">
                        <div class="text-center">
                            <h3 class="text-4xl font-bold text-gray-800 mb-4">
                                ${currentProblem.question}
                            </h3>
                            <div class="flex justify-center items-center space-x-4">
                                <input
                                    type="number"
                                    step="0.01"
                                    value="${userAnswer}"
                                    oninput="userAnswer = this.value; updateCheckButton()"
                                    onkeypress="if(event.key === 'Enter') checkAnswer()"
                                    class="text-2xl text-center border-3 border-indigo-300 rounded-lg px-4 py-3 focus:border-indigo-500 focus:outline-none font-bold"
                                    placeholder="Your answer"
                                    ${(showResult && isCorrect) || (showResult && attempts >= 4) || showNameInput ? 'disabled' : ''}
                                />
                                <button
                                    id="check-answer-btn"
                                    onclick="checkAnswer()"
                                    class="bg-gradient-to-r from-green-500 to-emerald-500 text-white px-6 py-3 rounded-lg font-bold hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    Check Answer
                                </button>
                            </div>
                        </div>
                    </div>

                    ${showResult ? `
                        <!-- Result -->
                        <div class="p-6 rounded-xl mb-6 ${isCorrect ? 'bg-green-100 border-2 border-green-300' : 'bg-red-100 border-2 border-red-300'}">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    ${isCorrect ? 
                                        '<svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>' :
                                        '<svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>'
                                    }
                                    <div>
                                        <h4 class="text-xl font-bold ${isCorrect ? 'text-green-800' : 'text-red-800'}">
                                            ${isCorrect ? 'Correct!' : 'Try Again!'}
                                        </h4>
                                        <p class="${isCorrect ? 'text-green-700' : 'text-red-700'}">
                                            ${isCorrect 
                                                ? `Great job! The answer is ${currentProblem.answer}`
                                                : showCorrectAnswer 
                                                    ? `The correct answer is ${currentProblem.answer}`
                                                    : `Attempt ${attempts} of 4 - Keep trying!`
                                            }
                                        </p>
                                        ${isCorrect ? `
                                            <p class="text-green-600 font-semibold mt-1">
                                                ${attempts === 1 ? 'üåü 5 Stars earned!' : 
                                                  attempts === 2 ? 'üåü 3 Stars earned!' : 
                                                  attempts === 3 ? 'üåü 1 Star earned!' : 
                                                  'No stars earned'}
                                            </p>
                                        ` : ''}
                                    </div>
                                </div>
                                ${isCorrect ? `
                                    <div class="flex items-center space-x-2">
                                        ${Array.from({length: attempts === 1 ? 5 : attempts === 2 ? 3 : attempts === 3 ? 1 : 0}, () => 
                                            '<svg class="w-6 h-6 text-yellow-500 fill-current" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>'
                                        ).join('')}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Action Buttons -->
                    <div class="flex justify-center space-x-4">
                        ${!showResult || (!isCorrect && attempts < 4) ? `
                            <button
                                onclick="resetProblem()"
                                class="bg-gray-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-gray-600 transition-all flex items-center space-x-2"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                <span>Reset</span>
                            </button>
                        ` : ''}
                        <button
                            onclick="nextProblem()"
                            class="bg-gradient-to-r from-indigo-500 to-purple-500 text-white px-6 py-3 rounded-lg font-bold hover:shadow-lg transition-all flex items-center space-x-2"
                        >
                            <span>Next Problem</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Leaderboard -->
                    <div class="mt-8">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-xl font-bold text-gray-800 flex items-center space-x-2">
                                    <svg class="w-6 h-6 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                    </svg>
                                    <span>Leaderboard</span>
                                </h3>
                                <div class="flex space-x-2">
                                    <button
                                        onclick="updateLeaderboard(); updateDisplay()"
                                        class="text-sm text-indigo-600 hover:text-indigo-800 underline"
                                    >
                                        Refresh
                                    </button>
                                    <button
                                        onclick="clearLeaderboard()"
                                        class="text-sm text-red-600 hover:text-red-800 underline"
                                    >
                                        Clear All
                                    </button>
                                </div>
                            </div>
                            
                            ${leaderboard.length > 0 ? `
                                <div class="space-y-2">
                                    ${leaderboard.slice(0, 10).map((entry, index) => `
                                        <div class="flex items-center justify-between p-3 rounded-lg ${
                                            entry.name === studentName && entry.class === studentClass 
                                                ? 'bg-indigo-50 border-2 border-indigo-200' 
                                                : 'bg-gray-50'
                                        }">
                                            <div class="flex items-center space-x-3">
                                                <div class="flex items-center justify-center w-8 h-8 rounded-full ${
                                                    index === 0 ? 'bg-yellow-400' :
                                                    index === 1 ? 'bg-gray-300' :
                                                    index === 2 ? 'bg-orange-400' : 'bg-gray-200'
                                                } text-white font-bold text-sm">
                                                    ${index + 1}
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-gray-800">${entry.name}</div>
                                                    <div class="text-sm text-gray-600">${entry.class}</div>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <div class="flex items-center space-x-1">
                                                    ${Array.from({length: Math.min(entry.totalStars, 10)}, () => 
                                                        '<svg class="w-4 h-4 text-yellow-500 fill-current" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>'
                                                    ).join('')}
                                                    ${entry.totalStars > 10 ? `<span class="text-sm text-gray-500">+${entry.totalStars - 10}</span>` : ''}
                                                </div>
                                                <div class="text-sm text-gray-600">${entry.problemsSolved} problems</div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : `
                                <div class="text-center text-gray-500 py-8">
                                    <svg class="w-12 h-12 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    <p>No scores yet. Be the first to solve problems!</p>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            } else {
                gameContent.innerHTML = '<div class="text-center text-gray-500">Loading...</div>';
            }
            
            // Update button state after rendering
            updateCheckButton();
        }

        // Initialize the game
        function initGame() {
            // Load saved student info
            const savedName = localStorage.getItem('mathstar_student_name');
            const savedClass = localStorage.getItem('mathstar_student_class');
            if (savedName && savedClass) {
                studentName = savedName;
                studentClass = savedClass;
                showNameInput = false;
            }
            
            // Load leaderboard
            leaderboard = JSON.parse(localStorage.getItem('mathstar_leaderboard') || '[]');
            
            nextProblem();
            updateDisplay();
        }

        // Initialize the game
        document.addEventListener('DOMContentLoaded', function() {
            initGame();
            
            // Make functions globally accessible
            window.checkAnswer = checkAnswer;
            window.nextProblem = nextProblem;
            window.resetProblem = resetProblem;
            window.setGrade = setGrade;
            window.setTopic = setTopic;
            
            console.log('MathStar 3D initialized');
            console.log('Available functions:', Object.keys(window).filter(key => ['checkAnswer', 'nextProblem', 'resetProblem', 'setGrade', 'setTopic'].includes(key)));
        });

        function selectExistingStudent(name, className) {
            studentName = name;
            studentClass = className;
            localStorage.setItem('mathstar_student_name', name);
            localStorage.setItem('mathstar_student_class', className);
            showNameInput = false;
            updateDisplay();
        }
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
</body>
</html> 